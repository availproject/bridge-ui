import e,{createContext as t,useState as a,useEffect as l,useContext as n,memo as s,useCallback as r}from"react";import{getWalletBySource as o,getWallets as i}from"@talismn/connect-wallets";import{create as c}from"zustand";import{useCookies as d}from"react-cookie";async function m(e=window.ethereum){try{return await e.request({method:"wallet_getSnaps"}),!0}catch(e){return!1}}process.env.SNAP_ORIGIN;const u=t({provider:null,installedSnap:null,error:null,setInstalledSnap:()=>{},setError:()=>{}}),p=({children:t})=>{const[n,s]=a(null),[r,o]=a(null),[i,c]=a(null);return l((()=>{(async function(){var e,t;if("undefined"==typeof window)return null;if(window.ethereum&&await m(window.ethereum))return window.ethereum;if(null===(e=window.ethereum)||void 0===e?void 0:e.detected)for(const e of window.ethereum.detected)if(await m(e))return e;if(null===(t=window.ethereum)||void 0===t?void 0:t.providers)for(const e of window.ethereum.providers)if(await m(e))return e;return null})().then(s).catch(console.error)}),[]),l((()=>{if(i){const e=setTimeout((()=>{c(null)}),1e4);return()=>{clearTimeout(e)}}}),[i]),e.createElement(u.Provider,{value:{provider:n,error:i,setError:c,installedSnap:r,setInstalledSnap:o}},t)};function w(){return n(u)}var h;const f=null!==(h=process.env.SNAP_ORIGIN)&&void 0!==h?h:"npm:@avail-project/avail-snap";function v(){const e=w();return async({method:t,params:a})=>{var l,n;try{return null!==(n=await(null===(l=e.provider)||void 0===l?void 0:l.request({method:t,params:a})))&&void 0!==n?n:null}catch(t){return e.setError(t),null}}}function g(){const{provider:e,setInstalledSnap:t,installedSnap:n}=w(),s=v(),[r,o]=a(!1),[i,c]=a(!1);l((()=>{(()=>{if("undefined"==typeof window)return;const{ethereum:e}=window,t=Boolean(e&&e.isMetaMask);c(t)})()}),[]);const d=null!==e,m=()=>{const{ethereum:e}=window;return Boolean(e&&e.isMetaMask)},u=async()=>{var e;const a=await s({method:"wallet_getSnaps"});t(null!==(e=a[f])&&void 0!==e?e:null)};return l((()=>{(async()=>{e&&(await m(),await u())})().catch(console.error)}),[e]),{isFlask:r,snapsDetected:d,installedSnap:n,getSnap:u,detectMetaMask:m,metamaskInstalled:i}}function x(e=f){const t=v();return async({method:a,params:l})=>t({method:"wallet_invokeSnap",params:{snapId:e,request:l?{method:a,params:l}:{method:a}}})}function b(e=f,t){const a=v(),{setInstalledSnap:l}=w();return async()=>{var n;const s=await a({method:"wallet_requestSnaps",params:{[e]:t?{version:t}:{}}});l(null!==(n=null==s?void 0:s[e])&&void 0!==n?n:null)}}const y=s((({selected:t,installedSnap:a,onDisconnect:l})=>{var n,s;return t?e.createElement("div",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-avail text-avail-foreground shadow hover:bg-avail/90 h-8 rounded-full px-3 cursor-pointer",onClick:()=>{navigator.clipboard.writeText(t.address)}},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"pr-1 h-5 w-5"},e.createElement("path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4"}),e.createElement("path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5"}),e.createElement("path",{d:"M18 9a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4v-8Z"})),"MetamaskSnap"===t.source?a?t.address.slice(0,6)+"..."+(null===(n=t.address)||void 0===n?void 0:n.slice(-4)):"Retry Connecting":t.address.slice(0,6)+"..."+(null===(s=t.address)||void 0===s?void 0:s.slice(-4)),e.createElement("button",{className:"ml-2",onClick:l},"MetamaskSnap"===t.source?a?e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 352 512",fill:"currentColor",width:"12",height:"12"},e.createElement("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"})):e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",width:"12",height:"12"},e.createElement("path",{d:"M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"})):e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 352 512",fill:"currentColor",width:"12",height:"12"},e.createElement("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"})))):null}));y.displayName="DisconnectWallet";const E=s((({selectedWallet:t,enabledAccounts:a,onAccountSelect:l})=>e.createElement(e.Fragment,null,e.createElement("br",null),t&&e.createElement("button",{className:"!text-lg mt-3 w-full font-thin bg-[#3a3b3cb1] text-left font-ppmori rounded-xl !p-8"},e.createElement("div",{className:"flex flex-row"},e.createElement("img",{alt:t.title,height:20,width:20,src:t.logo.src,className:"mr-4"}),t.title)),e.createElement("p",{className:"text-white my-3 !mt-4 text-opacity-70 font-ppmori font-light text-sm flex flex-row items-center justify-center space-x-2"},e.createElement("span",null,"Select Accounts"),e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4"},e.createElement("circle",{cx:"12",cy:"12",r:"10"}),e.createElement("polyline",{points:"8 12 12 16 16 12"}),e.createElement("line",{x1:"12",y1:"8",x2:"12",y2:"16"}))),e.createElement("div",{className:"flex flex-col gap-2 !max-h-48 overflow-y-scroll overflow-x-hidden pt-2"},a.map(((t,a)=>{var n,s;return e.createElement("button",{key:a,onClick:()=>l(t),className:"flex flex-row items-center justify-between bg-[#3a3b3cb1] rounded-xl !h-14 p-4"},e.createElement("div",{className:"flex flex-row items-center justify-start mx-auto w-full"},e.createElement("div",{className:"text-white text-opacity-90 space-x-2 !font-thicccboiregular text-md flex flex-row items-center justify-start"},e.createElement("p",null,"> "),e.createElement("p",{className:"font-thicccboisemibold text-xl cursor-pointer"},(null===(n=t.name)||void 0===n?void 0:n.length)>12?(null===(s=t.name)||void 0===s?void 0:s.slice(0,12))+"...":t.name),e.createElement("p",{className:"text-[#3489E8]"}," ","(",t.address.slice(0,6)+"..."+t.address.slice(-4),")"))))}))))));E.displayName="AccountSelector";const k=e=>({chain:e.runtimeChain.toString(),specVersion:e.runtimeVersion.specVersion.toNumber(),tokenDecimals:e.registry.chainDecimals[0]||18,tokenSymbol:e.registry.chainTokens[0]||"AVAIL",genesisHash:e.genesisHash.toHex(),ss58Format:"number"==typeof e.registry.chainSS58?e.registry.chainSS58:0,chainType:"substrate",icon:"substrate",types:{},userExtensions:[]});async function S({api:e,account:t,metadataCookie:a,selectedWallet:l,setCookie:n}){const s=o(t.source);if(e&&e.isConnected&&await e.isReady){if(s&&(!a||!a||a.wallet!==l.title))try{const t=k(e);await s.extension.metadata.provide(t),n("metadataUpdated",{wallet:l.title,updated:!0},{path:"/",sameSite:!0})}catch(e){console.error("Failed to update metadata",e)}}else console.debug("API not ready, cannot update metadata")}const N=async(e,t=3)=>{try{console.log(`Initializing API. Retries left: ${t}`);return await window.availJsSdk.initialize({endpoint:e})}catch(a){if(window.availJsSdk.disconnect(),t>0)return await new Promise((e=>setTimeout(e,2e3))),console.debug(`Retrying to initialize API. Retries left: ${t}`),N(e,t-1);throw new Error(`RPC_INITIALIZE_ERROR: ${a}`)}},A=s((({supportedWallets:t,onWalletSelect:a,metamaskInstalled:l})=>{const n=e.useMemo((()=>t.sort(((e,t)=>"SubWallet"===e.title?-1:"SubWallet"===t.title?1:0))),[t]);return e.createElement("div",{className:"flex flex-col gap-3 max-h-72 overflow-y-scroll"},e.createElement("button",{disabled:!l,className:"!text-lg font-thin bg-[#3a3b3cb1] text-left font-ppmori rounded-xl !p-8",onClick:()=>a({title:"MetamaskSnap"}),key:"Metamask"},e.createElement("div",{className:"flex flex-row"},e.createElement("img",{alt:"Metamask Snap",src:"/images/availsnap.png",width:"24",height:"24",className:"mr-4 h-6 w-6"}),"Avail Snap")),n.map((t=>e.createElement("button",{key:t.title,disabled:!t.installed,className:"!text-lg font-thin bg-[#3a3b3cb1] text-left font-ppmori rounded-xl !p-8",onClick:()=>a(t)},e.createElement("div",{className:"flex flex-row"},e.createElement("img",{alt:t.title,height:"20",width:"20",src:t.logo.src,className:"mr-4"}),t.title)))))}));A.displayName="WalletSelector";const C=c((e=>({selected:null,setSelected:t=>e({selected:t}),selectedWallet:null,setSelectedWallet:t=>e({selectedWallet:t})}))),W=({api:t})=>{const[n,s]=a(!1),[o,c]=a([]),[d,m]=a([]),[u,p]=a({}),w=b(),h=x(),{selected:f,setSelected:v,selectedWallet:k,setSelectedWallet:N}=C(),{installedSnap:W,metamaskInstalled:I}=g(),L=r((()=>{const e=i();return c(e),e}),[]);l((()=>{(async()=>{const e=L();if(u.substrateAddress&&u.substrateWallet)if("MetamaskSnap"===u.substrateWallet&&W)v({address:u.substrateAddress,source:"MetamaskSnap"});else{const t=e.find((e=>e.title===u.substrateWallet));if(!t)return;t.enable("avail-wallet").then((()=>{t.getAccounts().then((e=>{const a=e.filter((e=>"ethereum"!==e.type)),l=a.find((e=>e.address===u.substrateAddress));l&&(N(t),m(a),v(l))}))}))}})()}),[u.substrateAddress,u.substrateWallet,W,I,L,v,N]);const M=r((async e=>{if("MetamaskSnap"===e.title)try{await w();const e=await h({method:"getAddress"});v({address:e,source:"MetamaskSnap"}),p({...u,substrateAddress:e,substrateWallet:"MetamaskSnap"})}catch(e){console.error("Failed to connect to Avail Snap",e)}else{N(e),await e.enable("avail-wallet");const t=(await e.getAccounts()).filter((e=>"ethereum"!==e.type));m(t)}}),[h,w,u,p,v,N]),R=r((async e=>{v(e),p({...u,substrateAddress:e.address,substrateWallet:null==k?void 0:k.title}),t&&k&&await S({api:t,account:e,metadataCookie:u.metadataUpdated,selectedWallet:k,setCookie:(e,t,a)=>{p({...u,[e]:t})}}),s(!1),console.info(`AVAIL_WALLET_CONNECT - ${null==k?void 0:k.title} - ${e.address}`)}),[k,t,u,p,v]),_=r((()=>{p({}),v(null),N(null),m([])}),[p,v,N]);return e.createElement(e.Fragment,null,f?e.createElement(y,{selected:f,installedSnap:W,onDisconnect:_}):e.createElement("div",null,e.createElement("button",{onClick:()=>s(!n),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground shadow hover:bg-primary/90 h-9 px-4 py-2 !ml-2"},"Connect Wallet"),n&&e.createElement("div",{className:"fixed inset-0 z-50 flex items-start justify-center sm:items-center"},e.createElement("div",{className:"fixed inset-0 bg-black/50",onClick:()=>s(!1)}),e.createElement("div",{className:"z-50 grid w-full max-w-lg gap-4 bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg md:w-full"},e.createElement("div",{className:"sm:max-w-[425px] bg-[#252831] border-2 border-[#3a3b3cb1] rounded-xl p-4"},e.createElement("div",null,e.createElement("h2",{className:"font-bold text-3xl text-white"},"Connect Wallet"),0===d.length?e.createElement(e.Fragment,null,e.createElement("p",{className:"font-regular text-md text-white text-opacity-70 pt-2"},e.createElement("div",{className:"flex flex-row items-start justify-start pt-3 space-x-2"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},e.createElement("circle",{cx:"12",cy:"12",r:"10"}),e.createElement("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.createElement("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})),e.createElement("span",null,"Don't have an Avail Wallet yet? Checkout this"," ",e.createElement("a",{href:"https://docs.availspace.app/avail-space/web-dashboard-user-guide/getting-started/how-to-install-subwallet-and-create-a-new-avail-account?utm_source=avail&utm_medium=docspace&utm_campaign=avlclaim",className:"underline",target:"_blank",rel:"noopener noreferrer"},"cool tutorial")," ","by Subwallet."))),e.createElement("div",{className:"pb-3"}),e.createElement(A,{supportedWallets:o,onWalletSelect:M,metamaskInstalled:I})):e.createElement(E,{selectedWallet:k,enabledAccounts:d,onAccountSelect:R})),e.createElement("div",{className:"flex w-full mt-2 text-white text-opacity-70 !flex-col !items-center !justify-center"},e.createElement("div",null,d&&d.length>0?e.createElement("button",{disabled:d.length<=0,className:"!bg-[#252831] hover:text-white !border-0 !p-0",onClick:()=>{m([]),v(null)}},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-7 w-7 pr-2 inline-block"},e.createElement("path",{d:"m12 19-7-7 7-7"}),e.createElement("path",{d:"M19 12H5"})),e.createElement("span",{className:"text-lg"},"Go back to wallets")):e.createElement("p",null,"Scroll to find more wallets"))))))))},I=c(((e,t)=>({api:void 0,isReady:!1,setApi:t=>e({api:t}),ensureConnection:async a=>{const l=t().api;if((null==l?void 0:l.isConnected)&&await l.isReady)e({isReady:!0});else try{const l=await a();return l.on("ready",(()=>{e({isReady:!0})})),l.on("disconnected",(async()=>{e({isReady:!1}),setTimeout((()=>t().ensureConnection(a)),5e3)})),void e({api:l,isReady:!0})}catch(l){console.error("API_INTIALIZATION_ERROR",l),e({isReady:!1}),setTimeout((()=>t().ensureConnection(a)),5e3)}}}))),L=t({isConnected:!1,setRpcUrl:()=>{}}),M=()=>n(L),R=({children:t,api:n})=>{const[s,r]=a("undefined"!=typeof window?window.AVAIL_RPC_URL:void 0),[o,c]=d(["substrateAddress","substrateWallet","metadataUpdated"]),{selected:m,setSelected:u,selectedWallet:w,setSelectedWallet:h}=C(),{api:f,isReady:v,setApi:g,ensureConnection:x}=I();return l((()=>{if(n)return void g(n);if(!s)return;(async()=>{await x((()=>N(s)))})()}),[s,n,g,x]),l((()=>{(async()=>{if(o.substrateAddress&&o.substrateWallet&&v&&"MetamaskSnap"!==o.substrateWallet){const e=i().find((e=>e.title===o.substrateWallet));if(!e)return;try{await e.enable("avail-wallet");const t=await e.getAccounts(),a=t.filter((e=>"ethereum"!==e.type)).find((e=>e.address===o.substrateAddress));a&&(h(e),u(a))}catch(e){console.error("Failed to reconnect wallet:",e)}}})()}),[o.substrateAddress,o.substrateWallet,v,u,h]),e.createElement(p,null,e.createElement(L.Provider,{value:{api:f,isConnected:v,rpcUrl:s,setRpcUrl:r}},t))};export{E as AccountSelector,W as AvailWalletConnect,R as AvailWalletProvider,y as DisconnectWallet,u as MetaMaskContext,p as MetaMaskProvider,A as WalletSelector,k as getInjectorMetadata,N as initApi,S as updateMetadata,I as useApi,C as useAvailAccount,M as useAvailWallet,x as useInvokeSnap,g as useMetaMask,w as useMetaMaskContext,b as useRequestSnap};
//# sourceMappingURL=index.esm.js.map
