"use strict";var e=require("react"),t=require("@talismn/connect-wallets"),a=require("zustand"),l=require("react-cookie");async function n(e=window.ethereum){try{return await e.request({method:"wallet_getSnaps"}),!0}catch(e){return!1}}process.env.SNAP_ORIGIN;const s=e.createContext({provider:null,installedSnap:null,error:null,setInstalledSnap:()=>{},setError:()=>{}}),r=({children:t})=>{const[a,l]=e.useState(null),[r,o]=e.useState(null),[i,c]=e.useState(null);return e.useEffect((()=>{(async function(){var e,t;if("undefined"==typeof window)return null;if(window.ethereum&&await n(window.ethereum))return window.ethereum;if(null===(e=window.ethereum)||void 0===e?void 0:e.detected)for(const e of window.ethereum.detected)if(await n(e))return e;if(null===(t=window.ethereum)||void 0===t?void 0:t.providers)for(const e of window.ethereum.providers)if(await n(e))return e;return null})().then(l).catch(console.error)}),[]),e.useEffect((()=>{if(i){const e=setTimeout((()=>{c(null)}),1e4);return()=>{clearTimeout(e)}}}),[i]),e.createElement(s.Provider,{value:{provider:a,error:i,setError:c,installedSnap:r,setInstalledSnap:o}},t)};function o(){return e.useContext(s)}var i;const c=null!==(i=process.env.SNAP_ORIGIN)&&void 0!==i?i:"npm:@avail-project/avail-snap";function d(){const e=o();return async({method:t,params:a})=>{var l,n;try{return null!==(n=await(null===(l=e.provider)||void 0===l?void 0:l.request({method:t,params:a})))&&void 0!==n?n:null}catch(t){return e.setError(t),null}}}function u(){const{provider:t,setInstalledSnap:a,installedSnap:l}=o(),n=d(),[s,r]=e.useState(!1),[i,u]=e.useState(!1);e.useEffect((()=>{(()=>{if("undefined"==typeof window)return;const{ethereum:e}=window,t=Boolean(e&&e.isMetaMask);u(t)})()}),[]);const m=null!==t,p=()=>{const{ethereum:e}=window;return Boolean(e&&e.isMetaMask)},w=async()=>{var e;const t=await n({method:"wallet_getSnaps"});a(null!==(e=t[c])&&void 0!==e?e:null)};return e.useEffect((()=>{(async()=>{t&&(await p(),await w())})().catch(console.error)}),[t]),{isFlask:s,snapsDetected:m,installedSnap:l,getSnap:w,detectMetaMask:p,metamaskInstalled:i}}function m(e=c){const t=d();return async({method:a,params:l})=>t({method:"wallet_invokeSnap",params:{snapId:e,request:l?{method:a,params:l}:{method:a}}})}function p(e=c,t){const a=d(),{setInstalledSnap:l}=o();return async()=>{var n;const s=await a({method:"wallet_requestSnaps",params:{[e]:t?{version:t}:{}}});l(null!==(n=null==s?void 0:s[e])&&void 0!==n?n:null)}}const w=e.memo((({selected:t,installedSnap:a,onDisconnect:l})=>{var n,s;return t?e.createElement("div",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-avail text-avail-foreground shadow hover:bg-avail/90 h-8 rounded-full px-3 cursor-pointer",onClick:()=>{navigator.clipboard.writeText(t.address)}},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"pr-1 h-5 w-5"},e.createElement("path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4"}),e.createElement("path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5"}),e.createElement("path",{d:"M18 9a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4v-8Z"})),"MetamaskSnap"===t.source?a?t.address.slice(0,6)+"..."+(null===(n=t.address)||void 0===n?void 0:n.slice(-4)):"Retry Connecting":t.address.slice(0,6)+"..."+(null===(s=t.address)||void 0===s?void 0:s.slice(-4)),e.createElement("button",{className:"ml-2",onClick:l},"MetamaskSnap"===t.source?a?e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 352 512",fill:"currentColor",width:"12",height:"12"},e.createElement("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"})):e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",width:"12",height:"12"},e.createElement("path",{d:"M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"})):e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 352 512",fill:"currentColor",width:"12",height:"12"},e.createElement("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"})))):null}));w.displayName="DisconnectWallet";const f=e.memo((({selectedWallet:t,enabledAccounts:a,onAccountSelect:l})=>e.createElement(e.Fragment,null,e.createElement("br",null),t&&e.createElement("button",{className:"!text-lg mt-3 w-full font-thin bg-[#3a3b3cb1] text-left font-ppmori rounded-xl !p-8"},e.createElement("div",{className:"flex flex-row"},e.createElement("img",{alt:t.title,height:20,width:20,src:t.logo.src,className:"mr-4"}),t.title)),e.createElement("p",{className:"text-white my-3 !mt-4 text-opacity-70 font-ppmori font-light text-sm flex flex-row items-center justify-center space-x-2"},e.createElement("span",null,"Select Accounts"),e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4"},e.createElement("circle",{cx:"12",cy:"12",r:"10"}),e.createElement("polyline",{points:"8 12 12 16 16 12"}),e.createElement("line",{x1:"12",y1:"8",x2:"12",y2:"16"}))),e.createElement("div",{className:"flex flex-col gap-2 !max-h-48 overflow-y-scroll overflow-x-hidden pt-2"},a.map(((t,a)=>{var n,s;return e.createElement("button",{key:a,onClick:()=>l(t),className:"flex flex-row items-center justify-between bg-[#3a3b3cb1] rounded-xl !h-14 p-4"},e.createElement("div",{className:"flex flex-row items-center justify-start mx-auto w-full"},e.createElement("div",{className:"text-white text-opacity-90 space-x-2 !font-thicccboiregular text-md flex flex-row items-center justify-start"},e.createElement("p",null,"> "),e.createElement("p",{className:"font-thicccboisemibold text-xl cursor-pointer"},(null===(n=t.name)||void 0===n?void 0:n.length)>12?(null===(s=t.name)||void 0===s?void 0:s.slice(0,12))+"...":t.name),e.createElement("p",{className:"text-[#3489E8]"}," ","(",t.address.slice(0,6)+"..."+t.address.slice(-4),")"))))}))))));f.displayName="AccountSelector";const h=e=>({chain:e.runtimeChain.toString(),specVersion:e.runtimeVersion.specVersion.toNumber(),tokenDecimals:e.registry.chainDecimals[0]||18,tokenSymbol:e.registry.chainTokens[0]||"AVAIL",genesisHash:e.genesisHash.toHex(),ss58Format:"number"==typeof e.registry.chainSS58?e.registry.chainSS58:0,chainType:"substrate",icon:"substrate",types:{},userExtensions:[]});async function v({api:e,account:a,metadataCookie:l,selectedWallet:n,setCookie:s}){const r=t.getWalletBySource(a.source);if(e&&e.isConnected&&await e.isReady){if(r&&(!l||!l||l.wallet!==n.title))try{const t=h(e);await r.extension.metadata.provide(t),s("metadataUpdated",{wallet:n.title,updated:!0},{path:"/",sameSite:!0})}catch(e){console.error("Failed to update metadata",e)}}else console.debug("API not ready, cannot update metadata")}const x=async(e,t=3)=>{try{console.log(`Initializing API. Retries left: ${t}`);return await window.availJsSdk.initialize({endpoint:e})}catch(a){if(window.availJsSdk.disconnect(),t>0)return await new Promise((e=>setTimeout(e,2e3))),console.debug(`Retrying to initialize API. Retries left: ${t}`),x(e,t-1);throw new Error(`RPC_INITIALIZE_ERROR: ${a}`)}},g=e.memo((({supportedWallets:t,onWalletSelect:a,metamaskInstalled:l})=>{const n=e.useMemo((()=>t.sort(((e,t)=>"SubWallet"===e.title?-1:"SubWallet"===t.title?1:0))),[t]);return e.createElement("div",{className:"flex flex-col gap-3 max-h-72 overflow-y-scroll"},e.createElement("button",{disabled:!l,className:"!text-lg font-thin bg-[#3a3b3cb1] text-left font-ppmori rounded-xl !p-8",onClick:()=>a({title:"MetamaskSnap"}),key:"Metamask"},e.createElement("div",{className:"flex flex-row"},e.createElement("img",{alt:"Metamask Snap",src:"/images/availsnap.png",width:"24",height:"24",className:"mr-4 h-6 w-6"}),"Avail Snap")),n.map((t=>e.createElement("button",{key:t.title,disabled:!t.installed,className:"!text-lg font-thin bg-[#3a3b3cb1] text-left font-ppmori rounded-xl !p-8",onClick:()=>a(t)},e.createElement("div",{className:"flex flex-row"},e.createElement("img",{alt:t.title,height:"20",width:"20",src:t.logo.src,className:"mr-4"}),t.title)))))}));g.displayName="WalletSelector";const b=a.create((e=>({selected:null,setSelected:t=>e({selected:t}),selectedWallet:null,setSelectedWallet:t=>e({selectedWallet:t})}))),y=a.create(((e,t)=>({api:void 0,isReady:!1,setApi:t=>e({api:t}),ensureConnection:async a=>{const l=t().api;if((null==l?void 0:l.isConnected)&&await l.isReady)e({isReady:!0});else try{const l=await a();return l.on("ready",(()=>{e({isReady:!0})})),l.on("disconnected",(async()=>{e({isReady:!1}),setTimeout((()=>t().ensureConnection(a)),5e3)})),void e({api:l,isReady:!0})}catch(l){console.error("API_INTIALIZATION_ERROR",l),e({isReady:!1}),setTimeout((()=>t().ensureConnection(a)),5e3)}}}))),E=e.createContext({isConnected:!1,setRpcUrl:()=>{}});exports.AccountSelector=f,exports.AvailWalletConnect=({api:a})=>{const[l,n]=e.useState(!1),[s,r]=e.useState([]),[o,i]=e.useState([]),[c,d]=e.useState({}),h=p(),x=m(),{selected:y,setSelected:E,selectedWallet:k,setSelectedWallet:S}=b(),{installedSnap:C,metamaskInstalled:A}=u(),N=e.useCallback((()=>{const e=t.getWallets();return r(e),e}),[]);e.useEffect((()=>{(async()=>{const e=N();if(c.substrateAddress&&c.substrateWallet)if("MetamaskSnap"===c.substrateWallet&&C)E({address:c.substrateAddress,source:"MetamaskSnap"});else{const t=e.find((e=>e.title===c.substrateWallet));if(!t)return;t.enable("avail-wallet").then((()=>{t.getAccounts().then((e=>{const a=e.filter((e=>"ethereum"!==e.type)),l=a.find((e=>e.address===c.substrateAddress));l&&(S(t),i(a),E(l))}))}))}})()}),[c.substrateAddress,c.substrateWallet,C,A,N,E,S]);const W=e.useCallback((async e=>{if("MetamaskSnap"===e.title)try{await h();const e=await x({method:"getAddress"});E({address:e,source:"MetamaskSnap"}),d({...c,substrateAddress:e,substrateWallet:"MetamaskSnap"})}catch(e){console.error("Failed to connect to Avail Snap",e)}else{S(e),await e.enable("avail-wallet");const t=(await e.getAccounts()).filter((e=>"ethereum"!==e.type));i(t)}}),[x,h,c,d,E,S]),M=e.useCallback((async e=>{E(e),d({...c,substrateAddress:e.address,substrateWallet:null==k?void 0:k.title}),a&&k&&await v({api:a,account:e,metadataCookie:c.metadataUpdated,selectedWallet:k,setCookie:(e,t,a)=>{d({...c,[e]:t})}}),n(!1),console.info(`AVAIL_WALLET_CONNECT - ${null==k?void 0:k.title} - ${e.address}`)}),[k,a,c,d,E]),I=e.useCallback((()=>{d({}),E(null),S(null),i([])}),[d,E,S]);return e.createElement(e.Fragment,null,y?e.createElement(w,{selected:y,installedSnap:C,onDisconnect:I}):e.createElement("div",null,e.createElement("button",{onClick:()=>n(!l),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground shadow hover:bg-primary/90 h-9 px-4 py-2 !ml-2"},"Connect Wallet"),l&&e.createElement("div",{className:"fixed inset-0 z-50 flex items-start justify-center sm:items-center"},e.createElement("div",{className:"fixed inset-0 bg-black/50",onClick:()=>n(!1)}),e.createElement("div",{className:"z-50 grid w-full max-w-lg gap-4 bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg md:w-full"},e.createElement("div",{className:"sm:max-w-[425px] bg-[#252831] border-2 border-[#3a3b3cb1] rounded-xl p-4"},e.createElement("div",null,e.createElement("h2",{className:"font-bold text-3xl text-white"},"Connect Wallet"),0===o.length?e.createElement(e.Fragment,null,e.createElement("p",{className:"font-regular text-md text-white text-opacity-70 pt-2"},e.createElement("div",{className:"flex flex-row items-start justify-start pt-3 space-x-2"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},e.createElement("circle",{cx:"12",cy:"12",r:"10"}),e.createElement("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.createElement("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})),e.createElement("span",null,"Don't have an Avail Wallet yet? Checkout this"," ",e.createElement("a",{href:"https://docs.availspace.app/avail-space/web-dashboard-user-guide/getting-started/how-to-install-subwallet-and-create-a-new-avail-account?utm_source=avail&utm_medium=docspace&utm_campaign=avlclaim",className:"underline",target:"_blank",rel:"noopener noreferrer"},"cool tutorial")," ","by Subwallet."))),e.createElement("div",{className:"pb-3"}),e.createElement(g,{supportedWallets:s,onWalletSelect:W,metamaskInstalled:A})):e.createElement(f,{selectedWallet:k,enabledAccounts:o,onAccountSelect:M})),e.createElement("div",{className:"flex w-full mt-2 text-white text-opacity-70 !flex-col !items-center !justify-center"},e.createElement("div",null,o&&o.length>0?e.createElement("button",{disabled:o.length<=0,className:"!bg-[#252831] hover:text-white !border-0 !p-0",onClick:()=>{i([]),E(null)}},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-7 w-7 pr-2 inline-block"},e.createElement("path",{d:"m12 19-7-7 7-7"}),e.createElement("path",{d:"M19 12H5"})),e.createElement("span",{className:"text-lg"},"Go back to wallets")):e.createElement("p",null,"Scroll to find more wallets"))))))))},exports.AvailWalletProvider=({children:a,api:n})=>{const[s,o]=e.useState("undefined"!=typeof window?window.AVAIL_RPC_URL:void 0),[i,c]=l.useCookies(["substrateAddress","substrateWallet","metadataUpdated"]),{selected:d,setSelected:u,selectedWallet:m,setSelectedWallet:p}=b(),{api:w,isReady:f,setApi:h,ensureConnection:v}=y();return e.useEffect((()=>{if(n)return void h(n);if(!s)return;(async()=>{await v((()=>x(s)))})()}),[s,n,h,v]),e.useEffect((()=>{(async()=>{if(i.substrateAddress&&i.substrateWallet&&f&&"MetamaskSnap"!==i.substrateWallet){const e=t.getWallets().find((e=>e.title===i.substrateWallet));if(!e)return;try{await e.enable("avail-wallet");const t=await e.getAccounts(),a=t.filter((e=>"ethereum"!==e.type)).find((e=>e.address===i.substrateAddress));a&&(p(e),u(a))}catch(e){console.error("Failed to reconnect wallet:",e)}}})()}),[i.substrateAddress,i.substrateWallet,f,u,p]),e.createElement(r,null,e.createElement(E.Provider,{value:{api:w,isConnected:f,rpcUrl:s,setRpcUrl:o}},a))},exports.DisconnectWallet=w,exports.MetaMaskContext=s,exports.MetaMaskProvider=r,exports.WalletSelector=g,exports.getInjectorMetadata=h,exports.initApi=x,exports.updateMetadata=v,exports.useApi=y,exports.useAvailAccount=b,exports.useAvailWallet=()=>e.useContext(E),exports.useInvokeSnap=m,exports.useMetaMask=u,exports.useMetaMaskContext=o,exports.useRequestSnap=p;
//# sourceMappingURL=index.js.map
