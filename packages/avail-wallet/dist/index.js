"use strict";var e=require("react"),t=require("@talismn/connect-wallets"),a=require("avail-js-sdk"),l=require("zustand"),n=require("zustand/middleware");async function s(e=window.ethereum){try{return await e.request({method:"wallet_getSnaps"}),!0}catch(e){return!1}}process.env.SNAP_ORIGIN;const r=e.createContext({provider:null,installedSnap:null,error:null,setInstalledSnap:()=>{},setError:()=>{}}),o=({children:t})=>{const[a,l]=e.useState(null),[n,o]=e.useState(null),[c,i]=e.useState(null);return e.useEffect((()=>{(async function(){var e,t;if("undefined"==typeof window)return null;if(window.ethereum&&await s(window.ethereum))return window.ethereum;if(null===(e=window.ethereum)||void 0===e?void 0:e.detected)for(const e of window.ethereum.detected)if(await s(e))return e;if(null===(t=window.ethereum)||void 0===t?void 0:t.providers)for(const e of window.ethereum.providers)if(await s(e))return e;return null})().then(l).catch(console.error)}),[]),e.useEffect((()=>{if(c){const e=setTimeout((()=>{i(null)}),1e4);return()=>{clearTimeout(e)}}}),[c]),e.createElement(r.Provider,{value:{provider:a,error:c,setError:i,installedSnap:n,setInstalledSnap:o}},t)};function c(){return e.useContext(r)}var i;const d=null!==(i=process.env.SNAP_ORIGIN)&&void 0!==i?i:"npm:@avail-project/avail-snap";function u(){const e=c();return async({method:t,params:a})=>{var l,n;try{return null!==(n=await(null===(l=e.provider)||void 0===l?void 0:l.request({method:t,params:a})))&&void 0!==n?n:null}catch(t){return e.setError(t),null}}}function w(){const{provider:t,setInstalledSnap:a,installedSnap:l}=c(),n=u(),[s,r]=e.useState(!1),[o,i]=e.useState(!1);e.useEffect((()=>{(()=>{if("undefined"==typeof window)return;const{ethereum:e}=window,t=Boolean(e&&e.isMetaMask);i(t)})()}),[]);const w=null!==t,m=()=>{const{ethereum:e}=window;return Boolean(e&&e.isMetaMask)},p=async()=>{var e;const t=await n({method:"wallet_getSnaps"});a(null!==(e=t[d])&&void 0!==e?e:null)};return e.useEffect((()=>{(async()=>{t&&(await m(),await p())})().catch(console.error)}),[t]),{isFlask:s,snapsDetected:w,installedSnap:l,getSnap:p,detectMetaMask:m,metamaskInstalled:o}}function m(e=d){const t=u();return async({method:a,params:l})=>t({method:"wallet_invokeSnap",params:{snapId:e,request:l?{method:a,params:l}:{method:a}}})}function p(e=d,t){const a=u(),{setInstalledSnap:l}=c();return async()=>{var n;const s=await a({method:"wallet_requestSnaps",params:{[e]:t?{version:t}:{}}});l(null!==(n=null==s?void 0:s[e])&&void 0!==n?n:null)}}const h=e.memo((({selected:t,installedSnap:a,onDisconnect:l})=>{var n,s;return t?e.createElement("div",{className:"aw-flex-row aw-items-center aw-justify-center aw-text-sm aw-font-medium aw-rounded-xl aw-cursor-pointer aw-bg-darker aw-text-white aw-p-4",onClick:()=>{navigator.clipboard.writeText(t.address)}},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"aw-pr-2 aw-h-5 aw-w-5"},e.createElement("path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4"}),e.createElement("path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5"}),e.createElement("path",{d:"M18 9a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4v-8Z"})),"MetamaskSnap"===t.source?a?t.address.slice(0,6)+"..."+(null===(n=t.address)||void 0===n?void 0:n.slice(-4)):"Retry Connecting":t.address.slice(0,6)+"..."+(null===(s=t.address)||void 0===s?void 0:s.slice(-4)),e.createElement("button",{className:"aw-ml-2 aw-button",onClick:l},"MetamaskSnap"===t.source?a?e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 352 512",fill:"currentColor",width:"12",height:"12"},e.createElement("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"})):e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",width:"12",height:"12"},e.createElement("path",{d:"M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"})):e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 352 512",fill:"currentColor",width:"12",height:"12"},e.createElement("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"})))):null}));h.displayName="DisconnectWallet";const v=e.memo((({selectedWallet:t,enabledAccounts:a,onAccountSelect:l})=>e.createElement(e.Fragment,null,e.createElement("br",null),t&&e.createElement("button",{className:"aw-text-lg aw-mt-3 aw-w-full aw-font-thin aw-bg-darker aw-text-left aw-rounded-xl aw-p-8"},e.createElement("div",{className:"aw-flex-row"},e.createElement("img",{alt:t.title,height:20,width:20,src:t.logo.src,className:"aw-mr-4"}),t.title)),e.createElement("p",{className:"aw-text-white aw-my-3 aw-mt-4 aw-text-opacity-70 aw-font-light aw-text-sm aw-flex-row aw-items-center aw-justify-center aw-space-x-2"},e.createElement("span",null,"Select Accounts"),e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"aw-h-4 aw-w-4"},e.createElement("circle",{cx:"12",cy:"12",r:"10"}),e.createElement("polyline",{points:"8 12 12 16 16 12"}),e.createElement("line",{x1:"12",y1:"8",x2:"12",y2:"16"}))),e.createElement("div",{className:"aw-flex-col aw-gap-2 aw-max-h-48 aw-overflow-y-scroll aw-overflow-x-hidden aw-pt-2"},a.map(((t,a)=>{var n,s;return e.createElement("button",{key:a,onClick:()=>l(t),className:"aw-flex-row aw-items-center aw-justify-between aw-bg-darker aw-rounded-xl aw-h-14 aw-p-4 aw-button"},e.createElement("div",{className:"aw-flex-row aw-items-center aw-justify-start aw-mx-auto aw-w-full"},e.createElement("div",{className:"aw-text-white aw-text-opacity-90 aw-space-x-2 aw-text-md aw-flex-row aw-items-center aw-justify-start"},e.createElement("p",null,"> "),e.createElement("p",{className:"aw-font-semibold aw-text-xl aw-cursor-pointer"},(null===(n=t.name)||void 0===n?void 0:n.length)>12?(null===(s=t.name)||void 0===s?void 0:s.slice(0,12))+"...":t.name),e.createElement("p",{className:"aw-text-blue"}," ","(",t.address.slice(0,6)+"..."+t.address.slice(-4),")"))))}))))));v.displayName="AccountSelector";const f=e=>({chain:e.runtimeChain.toString(),specVersion:e.runtimeVersion.specVersion.toNumber(),tokenDecimals:e.registry.chainDecimals[0]||18,tokenSymbol:e.registry.chainTokens[0]||"AVAIL",genesisHash:e.genesisHash.toHex(),ss58Format:"number"==typeof e.registry.chainSS58?e.registry.chainSS58:0,chainType:"substrate",icon:"substrate",types:{},userExtensions:[]});async function x({api:e,account:a,metadataCookie:l,selectedWallet:n,setCookie:s}){const r=t.getWalletBySource(a.source);if(e&&e.isConnected&&await e.isReady){if(r&&(!l||!l||l.wallet!==n.title))try{const t=f(e);await r.extension.metadata.provide(t),s("metadataUpdated",{wallet:n.title,updated:!0},{})}catch(e){console.error("Failed to update metadata",e)}}else console.debug("API not ready, cannot update metadata")}const g=async(e,t=3)=>{try{console.log(`Initializing API. Retries left: ${t}`);return await a.initialize(e)}catch(l){if(a.disconnect(),t>0)return await new Promise((e=>setTimeout(e,2e3))),console.debug(`Retrying to initialize API. Retries left: ${t}`),g(e,t-1);throw new Error(`RPC_INITIALIZE_ERROR: ${l}`)}},E=e.memo((({supportedWallets:t,onWalletSelect:a,metamaskInstalled:l})=>{const n=e.useMemo((()=>t.sort(((e,t)=>"SubWallet"===e.title?-1:"SubWallet"===t.title?1:0))),[t]);return e.createElement("div",{className:"aw-flex-col aw-gap-3 aw-max-h-72 aw-overflow-y-scroll"},e.createElement("button",{disabled:!l,className:"aw-text-lg aw-font-thin aw-bg-darker aw-text-left aw-rounded-xl aw-p-8 aw-button",onClick:()=>a({title:"MetamaskSnap"}),key:"Metamask"},e.createElement("div",{className:"aw-flex-row"},e.createElement("img",{alt:"Metamask Snap",src:"/images/availsnap.png",width:"24",height:"24",className:"aw-mr-4 aw-h-6 aw-w-6"}),"Avail Snap")),n.map((t=>e.createElement("button",{key:t.title,disabled:!t.installed,className:"aw-text-lg aw-font-thin aw-bg-darker aw-text-left aw-rounded-xl aw-p-8 aw-button",onClick:()=>a(t)},e.createElement("div",{className:"aw-flex-row"},e.createElement("img",{alt:t.title,height:"20",width:"20",src:t.logo.src,className:"aw-mr-4"}),t.title)))))}));E.displayName="WalletSelector";const y=l.create()(n.persist((e=>({selected:null,setSelected:t=>e({selected:t}),selectedWallet:null,setSelectedWallet:t=>e({selectedWallet:t}),metadataUpdated:!1,setMetadataUpdated:t=>e({metadataUpdated:t}),clearWalletState:()=>e({selected:null,selectedWallet:null,metadataUpdated:!1})})),{name:"avail-wallet-storage",storage:n.createJSONStorage((()=>localStorage)),partialize:e=>({selected:e.selected,selectedWallet:e.selectedWallet,metadataUpdated:e.metadataUpdated})})),k=l.create(((e,t)=>({api:void 0,isReady:!1,setApi:t=>e({api:t}),ensureConnection:async a=>{const l=t().api;if((null==l?void 0:l.isConnected)&&await l.isReady)e({isReady:!0});else try{const l=await a();return l.on("ready",(()=>{e({isReady:!0})})),l.on("disconnected",(async()=>{e({isReady:!1}),setTimeout((()=>t().ensureConnection(a)),5e3)})),void e({api:l,isReady:!0})}catch(l){console.error("API_INTIALIZATION_ERROR",l),e({isReady:!1}),setTimeout((()=>t().ensureConnection(a)),5e3)}}}))),S=e.createContext({isConnected:!1,setRpcUrl:()=>{}});exports.AccountSelector=v,exports.AvailWalletConnect=({api:a})=>{const[l,n]=e.useState(!1),[s,r]=e.useState([]),[o,c]=e.useState([]),{api:i}=k(),d=p(),u=m(),{selected:f,setSelected:g,selectedWallet:S,setSelectedWallet:b,metadataUpdated:C,setMetadataUpdated:N,clearWalletState:W}=y(),{installedSnap:A,metamaskInstalled:M}=w(),I=e.useCallback((()=>{const e=t.getWallets();return r(e),e}),[]);e.useEffect((()=>{(async()=>{const e=I();if((null==f?void 0:f.address)&&(null==S?void 0:S.title))if("MetamaskSnap"===S.title&&A);else{const t=e.find((e=>e.title===(null==S?void 0:S.title)));if(!t)return;t.enable("bridge-ui").then((()=>{t.getAccounts().then((e=>{const t=e.filter((e=>"ethereum"!==e.type));t.find((e=>e.address===(null==f?void 0:f.address)))&&c(t)}))}))}})()}),[A,M,I]);const L=e.useCallback((async e=>{if("MetamaskSnap"===e.title)try{await d();const e=await u({method:"getAddress"});g({address:e,source:"MetamaskSnap"}),b({title:"MetamaskSnap"})}catch(e){console.error("Failed to connect to Avail Snap",e)}else{b(e),await e.enable("avail-wallet");const t=(await e.getAccounts()).filter((e=>"ethereum"!==e.type));c(t)}}),[u,d,g,b]),R=e.useCallback((async e=>{g(e);const t=a||i;t&&S&&await x({api:t,account:e,metadataCookie:C,selectedWallet:S,setCookie:(e,t,a)=>{"metadataUpdated"===e&&N(t)}}),n(!1),console.info(`AVAIL_WALLET_CONNECT - ${null==S?void 0:S.title} - ${e.address}`)}),[S,a,i,C,N,g]),_=e.useCallback((()=>{W(),c([])}),[W]);return e.createElement(e.Fragment,null,f?e.createElement(h,{selected:f,installedSnap:A,onDisconnect:_}):e.createElement("div",null,e.createElement("button",{onClick:()=>n(!l),className:"aw-button aw-button-primary aw-ml-2"},"Connect Wallet"),l&&e.createElement("div",{className:"aw-dialog-overlay"},e.createElement("div",{className:"fixed inset-0 bg-black/50",onClick:()=>n(!1)}),e.createElement("div",{className:"aw-dialog-content"},e.createElement("div",{className:"aw-bg-dark aw-border-2 aw-border-darker aw-rounded-xl p-4"},e.createElement("div",null,e.createElement("h2",{className:"aw-font-bold aw-text-3xl aw-text-white"},"Connect Wallet"),0===o.length?e.createElement(e.Fragment,null,e.createElement("p",{className:"aw-text-md aw-text-white aw-text-opacity-70 aw-pt-2"},e.createElement("div",{className:"aw-flex-row aw-items-start aw-justify-start aw-pt-3 aw-space-x-2"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},e.createElement("circle",{cx:"12",cy:"12",r:"10"}),e.createElement("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.createElement("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})),e.createElement("span",null,"Don't have an Avail Wallet yet? Checkout this"," ",e.createElement("a",{href:"https://docs.availspace.app/avail-space/web-dashboard-user-guide/getting-started/how-to-install-subwallet-and-create-a-new-avail-account?utm_source=avail&utm_medium=docspace&utm_campaign=avlclaim",className:"aw-underline",target:"_blank",rel:"noopener noreferrer"},"cool tutorial")," ","by Subwallet."))),e.createElement("div",{className:"pb-3"}),e.createElement(E,{supportedWallets:s,onWalletSelect:L,metamaskInstalled:M})):e.createElement(v,{selectedWallet:S,enabledAccounts:o,onAccountSelect:R})),e.createElement("div",{className:"flex w-full mt-2 text-white text-opacity-70 !flex-col !items-center !justify-center"},e.createElement("div",null,o&&o.length>0?e.createElement("button",{disabled:o.length<=0,className:"aw-bg-dark aw-button aw-button-outline",onClick:()=>{c([]),g(null)}},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"aw-h-7 aw-w-7 aw-pr-2 inline-block"},e.createElement("path",{d:"m12 19-7-7 7-7"}),e.createElement("path",{d:"M19 12H5"})),e.createElement("span",{className:"aw-text-lg"},"Go back to wallets")):e.createElement("p",null,"Scroll to find more wallets"))))))))},exports.AvailWalletProvider=({children:a,api:l,rpcUrl:n})=>{const[s,r]=e.useState(n||"wss://turing-rpc.avail.so/"),{selected:c,setSelected:i,selectedWallet:d,setSelectedWallet:u,metadataUpdated:w}=y(),{api:m,isReady:p,setApi:h,ensureConnection:v}=k();return e.useEffect((()=>{if(l)return void h(l);if(!s)return;(async()=>{await v((()=>g(s)))})()}),[s,l,h,v]),e.useEffect((()=>{(async()=>{if((null==c?void 0:c.address)&&(null==d?void 0:d.title)&&p&&"MetamaskSnap"!==d.title){const e=t.getWallets().find((e=>e.title===d.title));if(!e)return;try{await e.enable("avail-wallet");const t=await e.getAccounts(),a=t.filter((e=>"ethereum"!==e.type)).find((e=>e.address===c.address));a&&(u(e),i(a))}catch(e){console.error("Failed to reconnect wallet:",e)}}})()}),[c,d,p,i,u]),e.createElement(o,null,e.createElement(S.Provider,{value:{api:m,isConnected:p,rpcUrl:s,setRpcUrl:r}},a))},exports.DisconnectWallet=h,exports.MetaMaskContext=r,exports.MetaMaskProvider=o,exports.WalletSelector=E,exports.getInjectorMetadata=f,exports.initApi=g,exports.updateMetadata=x,exports.useApi=k,exports.useAvailAccount=y,exports.useAvailWallet=()=>e.useContext(S),exports.useInvokeSnap=m,exports.useMetaMask=w,exports.useMetaMaskContext=c,exports.useRequestSnap=p;
//# sourceMappingURL=index.js.map
